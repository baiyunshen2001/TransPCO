module_id=1
wdir='/scratch/midway2/liliw1/TCGA/'
dir_data='/project2/xuanyao/llw/breastcancerTCGA/txt_file/'
p_method='TruncPCO'

# prepare expression bed file
data_type='obs'
Rscript --no-save --no-restore ./script/prep.bed.R $dir_data $data_type
ls $dir_data | grep 'expression.module' | gzip

bash z.sh
bash p.sh


data_type='null'
Rscript --no-save --no-restore ./script/prep.bed.R $dir_data $data_type
ls $dir_data | grep 'expression.null.module' | gzip

bash z.sh
bash p.sh



configfile:"config.yaml"

rule all:
  input:
    expand(config['trans_DIR']+'chr{chr}_fix_p_20sva_sub{sub}.txt',chr=config['CHRS'],sub=config['SUBS'])


rule covariates:
  input:
    file_covariates=config['dir_data']+config['file_covariates']
    file_ex=config['dir_data']+config['file_ex']
  output:
    file_ex_var_regressed=config[dir_w]+'data/'+config['file_ex_var_regressed']
  script:
    config[dir_script]+config['script_covariates']
    
rule remove_gene:
  input:
    file_ex_var_regressed=config[dir_w]+'data/'+config['file_ex_var_regressed'],
    file_gene_meta=config['dir_data']+config['file_gene_meta'],
    file_pseudogenes=config['dir_data']+config['file_pseudogenes'],
    file_mappability=config['dir_data']+config['file_mappability'],
    file_cross_mappable_genes=config['dir_data']+config['file_cross_mappable_genes']
  output:
    file_genes_rm_info=config[dir_w]+'data/'+config['file_genes_rm_info']
  script:
    config[dir_script]+config['script_remove_gene']

rule coexp_module:
  input:
    file_ex_var_regressed=config[dir_w]+'data/'+config['file_ex_var_regressed'],
    file_genes_rm_info=config[dir_w]+'data/'+config['file_genes_rm_info']
  output:
    file_coexp_module=config[dir_w]+'data/'+config['file_coexp_module']
  log: 'coexp_module.log'
  script:
    config[dir_script]+config['script_coexp_module']
    
rule sample_name:
  input: config['dir_data']+'chr22_QCed.fam'
  output: config['dir_data']+config['file_sample_name']
  shell: 'cat {input} | cut -d" " -f1 > {output}'
  
rule prep_bed:
  input:
    file_sample_name,
    file_covariates,
    file_gene_meta,
    file_coexp_module
    file_ex=config['dir_data']+config['file_ex']
  output:
    expand(config['dir_data']+'expression.module{k}.bed', k=config['MODULE'])
  params:
    data_type='obs'
  script:
    config[dir_script]+config['script_prep_bed']
    

rule zscore:
  input:
  output:
  params:
  conda:
  log:

rule prep_bed_null:
  input:
  output:
  params:
  script:
  

